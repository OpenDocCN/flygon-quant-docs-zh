- en: Data - Replay
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ•°æ® - å›æ”¾
- en: åŸæ–‡ï¼š[https://www.backtrader.com/docu/data-replay/data-replay/](https://www.backtrader.com/docu/data-replay/data-replay/)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡ï¼š[https://www.backtrader.com/docu/data-replay/data-replay/](https://www.backtrader.com/docu/data-replay/data-replay/)
- en: The time is gone and testing a strategy against a fully formed and closed bar
    is good, but it could be better.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: æ—¶é—´å·²ç»è¿‡å»ï¼Œé’ˆå¯¹å®Œå…¨å½¢æˆå’Œå…³é—­çš„æ¯æ—¥æŸ±è¿›è¡Œç­–ç•¥æµ‹è¯•æ˜¯å¥½çš„ï¼Œä½†å¯ä»¥æ›´å¥½ã€‚
- en: 'This is where *Data Replay* comes in to help. If:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°±æ˜¯*æ•°æ®å›æ”¾*å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å¦‚æœï¼š
- en: 'The strategy operates on data with a timeframe X (example: daily)'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¯¥ç­–ç•¥åœ¨æ—¶é—´æ¡†æ¶Xçš„æ•°æ®ä¸Šè¿è¡Œï¼ˆç¤ºä¾‹ï¼šæ¯æ—¥ï¼‰
- en: and
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸”
- en: 'Data for a smaller timeframe Y (example: 1 minute) is available'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è¾ƒå°æ—¶é—´æ¡†æ¶Yçš„æ•°æ®ï¼ˆç¤ºä¾‹ï¼š1åˆ†é’Ÿï¼‰å¯ç”¨
- en: 'Data replay does exactly what the name implies:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®å›æ”¾æ­£æ˜¯å…¶åç§°æ‰€ç¤ºçš„ï¼š
- en: Replay a daily bar using the 1 minute data
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨1åˆ†é’Ÿæ•°æ®é‡æ”¾æ¯æ—¥æŸ±
- en: 'This is of course not exactly how the market developed, but it is far better
    than looking at the daily fully formed and closed bar in isolation:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œè¿™å¹¶ä¸å®Œå…¨æ˜¯å¸‚åœºçš„å‘å±•æ–¹å¼ï¼Œä½†æ¯”å­¤ç«‹åœ°æŸ¥çœ‹æ¯æ—¥å®Œå…¨å½¢æˆå’Œå…³é—­çš„æŸ±è¦å¥½å¾—å¤šï¼š
- en: If the strategy operates in realtime during the formation of the daily bar,
    the approximation of the formation of the bar gives a chance to replicate the
    actual behavior of the strategy under real conditions
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœç­–ç•¥åœ¨å½¢æˆæ—¥æŸ±æ—¶å®æ—¶è¿è¡Œï¼Œåˆ™æŸ±çš„å½¢æˆè¿‘ä¼¼ä¼šç»™äºˆæœºä¼šå¤åˆ¶ç­–ç•¥åœ¨å®é™…æ¡ä»¶ä¸‹çš„å®é™…è¡Œä¸º
- en: Putting *Data Replay* into action follows the regular usage patterns of `backtrader`
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: å®æ–½*æ•°æ®å›æ”¾*éµå¾ª`backtrader`çš„å¸¸è§„ä½¿ç”¨æ¨¡å¼
- en: Load a data feed
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åŠ è½½æ•°æ®æº
- en: Pass the data to cerebro with `replaydata`
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°†æ•°æ®ä¼ é€’ç»™cerebroï¼Œä½¿ç”¨`replaydata`
- en: Add a strategy
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ·»åŠ ä¸€ä¸ªç­–ç•¥
- en: Note
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„
- en: Preloading is not supported when data is being replayed because each bar is
    actually built in real-time. It will automatically disabled in any `Cerebro` instance.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æ•°æ®è¢«é‡æ–°æ’­æ”¾æ—¶ï¼Œä¸æ”¯æŒé¢„åŠ è½½ï¼Œå› ä¸ºæ¯ä¸ªæŸ±å®é™…ä¸Šæ˜¯å®æ—¶æ„å»ºçš„ã€‚å®ƒå°†è‡ªåŠ¨åœ¨ä»»ä½•`Cerebro`å®ä¾‹ä¸­ç¦ç”¨ã€‚
- en: 'Parameters which can be passed to `replaydata`:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: å¯ä»¥ä¼ é€’ç»™`replaydata`çš„å‚æ•°ï¼š
- en: '`timeframe` (default: bt.TimeFrame.Days)'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`timeframe` (é»˜è®¤å€¼ï¼šbt.TimeFrame.Days)'
- en: Destination timeframe which to be useful has to be equal or larger than the
    source
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: ç›®æ ‡æ—¶é—´æ¡†æ¶å¿…é¡»ä¸æºæ—¶é—´æ¡†æ¶ç›¸ç­‰æˆ–æ›´å¤§æ‰èƒ½å‘æŒ¥ä½œç”¨
- en: '`compression` (default: 1)'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`compression` (é»˜è®¤å€¼ï¼š1)'
- en: Compress the selected value â€œnâ€ to 1 bar
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: å°†æ‰€é€‰å€¼â€œnâ€å‹ç¼©ä¸º1æ ¹æŸ±
- en: 'Extended parameters (do not touch if not really needed):'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰©å±•å‚æ•°ï¼ˆå¦‚æœä¸æ˜¯çœŸæ­£éœ€è¦ï¼Œè¯·å‹¿ä¿®æ”¹ï¼‰ï¼š
- en: '`bar2edge` (default: True)'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bar2edge` (é»˜è®¤å€¼ï¼šTrue)'
- en: replays using time boundaries as the target of the closed bar. For example with
    a â€œticks -> 5 secondsâ€ the resulting 5 seconds bars will be aligned to xx:00,
    xx:05, xx:10 â€¦
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: ä½¿ç”¨æ—¶é—´è¾¹ç•Œä½œä¸ºå°é—­æŸ±çš„ç›®æ ‡è¿›è¡Œå›æ”¾ã€‚ä¾‹å¦‚ï¼Œâ€œticks -> 5 secondsâ€ï¼Œç”Ÿæˆçš„5ç§’æŸ±å°†å¯¹é½åˆ°xx:00ã€xx:05ã€xx:10ç­‰ã€‚
- en: '`adjbartime` (default: False)'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`adjbartime` (é»˜è®¤å€¼ï¼šFalse)'
- en: Use the time at the boundary to adjust the time of the delivered resampled bar
    instead of the last seen timestamp. If resampling to â€œ5 secondsâ€ the time of the
    bar will be adjusted for example to hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")05 even if the last seen timestamp was hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")04.33
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: ä½¿ç”¨è¾¹ç•Œå¤„çš„æ—¶é—´æ¥è°ƒæ•´äº¤ä»˜çš„é‡æ–°é‡‡æ ·æŸ±çš„æ—¶é—´ï¼Œè€Œä¸æ˜¯ä¸Šæ¬¡çœ‹åˆ°çš„æ—¶é—´æˆ³ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé‡æ–°é‡‡æ ·ä¸ºâ€œ5ç§’â€ï¼Œåˆ™æŸ±çš„æ—¶é—´å°†è¢«è°ƒæ•´ä¸ºhh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")05ï¼Œå³ä½¿ä¸Šæ¬¡çœ‹åˆ°çš„æ—¶é—´æˆ³æ˜¯hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png ":mm:")04.33ã€‚
- en: '**NOTE**: Time will only be adjusted if â€œbar2edgeâ€ is True. It wouldnâ€™t make
    sense to adjust the time if the bar has not been aligned to a boundary'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**æ³¨æ„**ï¼šä»…å½“â€œbar2edgeâ€ä¸ºTrueæ—¶æ‰ä¼šè°ƒæ•´æ—¶é—´ã€‚å¦‚æœæŸ±æœªå¯¹é½åˆ°è¾¹ç•Œï¼Œè°ƒæ•´æ—¶é—´æ˜¯æ²¡æœ‰æ„ä¹‰çš„'
- en: '`rightedge` (default: True)'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`rightedge` (é»˜è®¤å€¼ï¼šTrue)'
- en: Use the right edge of the time boundaries to set the time.
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: ä½¿ç”¨æ—¶é—´è¾¹ç•Œçš„å³è¾¹ç¼˜æ¥è®¾ç½®æ—¶é—´ã€‚
- en: If False and compressing to 5 seconds the time of a resampled bar for seconds
    between hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png ":mm:")00 and hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")04 will be hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png ":mm:")00
    (the starting boundary
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: å¦‚æœä¸ºFalseï¼Œå¹¶ä¸”å‹ç¼©åˆ°5ç§’ï¼Œåˆ™å¯¹äºhh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png ":mm:")00å’Œhh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")04ä¹‹é—´çš„ç§’æ•°ï¼Œé‡æ–°é‡‡æ ·æŸ±çš„æ—¶é—´å°†æ˜¯hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")00ï¼ˆèµ·å§‹è¾¹ç•Œ
- en: If True the used boundary for the time will be hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png
    ":mm:")05 (the ending boundary)
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: å¦‚æœä¸ºTrueï¼Œåˆ™ç”¨äºæ—¶é—´çš„è¾¹ç•Œå°†æ˜¯hh![ğŸ‡²ğŸ‡²](../Images/3e6ba424774c41defcb4e0fc29c71826.png ":mm:")05ï¼ˆç»“æŸè¾¹ç•Œï¼‰
- en: 'For the sake of working with a example the standard 2006 daily data will be
    replayed on a weekly basis. Which means:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ä¸ç¤ºä¾‹ä¸€èµ·å·¥ä½œï¼Œå°†æ ‡å‡†çš„2006å¹´æ—¥å¸¸æ•°æ®æŒ‰å‘¨é‡æ”¾ã€‚è¿™æ„å‘³ç€ï¼š
- en: There will finally be 52 bars, one for each week
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æœ€ç»ˆå°†æœ‰52ä¸ªæŸ±ï¼Œæ¯å‘¨ä¸€ä¸ª
- en: Cerebro will call `prenext` and `next` a total of 255 times, which is the original
    count of daily bars
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Cerebroå°†æ€»å…±è°ƒç”¨`prenext`å’Œ`next` 255æ¬¡ï¼Œè¿™æ˜¯æ¯æ—¥Kçº¿çš„åŸå§‹è®¡æ•°
- en: 'The trick:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: æŠ€å·§ï¼š
- en: When a weekly bar is forming, the length (`len(self)`) of the strategy will
    remain unchanged.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å½“å‘¨Kçº¿å½¢æˆæ—¶ï¼Œç­–ç•¥çš„é•¿åº¦ï¼ˆ`len(self)`ï¼‰å°†ä¿æŒä¸å˜ã€‚
- en: With each new week the length will increase by one
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¯åˆ°æ–°çš„ä¸€å‘¨ï¼Œé•¿åº¦å°†å¢åŠ ä¸€æ¬¡
- en: Some examples below, but first the sauce of the test script in which the data
    is loaded and passed to cerebro with `replaydata` â€¦ and then `run`.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œä½†é¦–å…ˆæ˜¯æµ‹è¯•è„šæœ¬çš„æºç ï¼Œå…¶ä¸­æ•°æ®è¢«åŠ è½½å¹¶é€šè¿‡`replaydata`ä¼ é€’ç»™cerebroï¼Œç„¶åè¿è¡Œã€‚
- en: '[PRE0]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Example - Replay Daily to Weekly
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¤ºä¾‹ - æ¯æ—¥é‡æ”¾åˆ°å‘¨çº¿
- en: 'The invocation of the script:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: è„šæœ¬çš„è°ƒç”¨ï¼š
- en: '[PRE1]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The chart cannot unfortunately show us the real thing happening in the background,
    so letâ€™s have a look at the console output:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å¹¸çš„æ˜¯ï¼Œå›¾è¡¨æ— æ³•å‘æˆ‘ä»¬å±•ç¤ºèƒŒæ™¯ä¸­çœŸå®å‘ç”Ÿçš„äº‹æƒ…ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
- en: '[PRE2]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: As we see the internal `self.counter` variable is keeping track of each call
    to either `prenext` or `next`. The former being called before the applied Simple
    Moving Average produces a value. The latter called when the Simple Moving Average
    is producing values.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œå†…éƒ¨çš„`self.counter`å˜é‡æ­£åœ¨è·Ÿè¸ªæ¯æ¬¡è°ƒç”¨`prenext`æˆ–`next`ã€‚å‰è€…åœ¨åº”ç”¨ç®€å•ç§»åŠ¨å¹³å‡äº§ç”Ÿå€¼ä¹‹å‰è°ƒç”¨ã€‚åè€…åœ¨ç®€å•ç§»åŠ¨å¹³å‡äº§ç”Ÿå€¼æ—¶è°ƒç”¨ã€‚
- en: 'The key:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: å…³é”®ï¼š
- en: The length (len(self)) of the strategy changes every 5 bars (5 trading days
    in the week)
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç­–ç•¥çš„é•¿åº¦ï¼ˆlen(self)ï¼‰æ¯5æ ¹Kçº¿ï¼ˆä¸€å‘¨5ä¸ªäº¤æ˜“æ—¥ï¼‰å˜åŒ–ä¸€æ¬¡
- en: 'The strategy is effectively seeing:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ç­–ç•¥æœ‰æ•ˆåœ°çœ‹åˆ°ï¼š
- en: How the weekly bar developed in 5 shots.
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¯å‘¨Kçº¿å¦‚ä½•åœ¨5æ¬¡è¿­ä»£ä¸­å‘å±•ã€‚
- en: This, again, doesnâ€™t replicate the actual tick-by-tick (and not even minute,
    hour) development of the market, but it is better than actually seeing a bar.
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: å†æ¬¡å¼ºè°ƒï¼Œè¿™å¹¶ä¸å¤åˆ¶å¸‚åœºçš„å®é™…é€ç¬”ï¼ˆç”šè‡³ä¸æ˜¯åˆ†é’Ÿã€å°æ—¶ï¼‰å‘å±•ï¼Œä½†æ¯”çœ‹åˆ°ä¸€æ ¹Kçº¿è¦å¥½ã€‚
- en: The visual output is that of the weekly chart which is the final outcome the
    system is being tested again.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: å¯è§†åŒ–è¾“å‡ºæ˜¯å‘¨çº¿å›¾è¡¨ï¼Œè¿™æ˜¯ç³»ç»Ÿæ­£åœ¨è¿›è¡Œæµ‹è¯•çš„æœ€ç»ˆç»“æœã€‚
- en: '![image](../Images/2009aea7cd7025e611fb9a739ba9f5b2.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ç‰‡](../Images/2009aea7cd7025e611fb9a739ba9f5b2.png)'
- en: Example 2 - Daily to Daily with Compression
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¤ºä¾‹2 - æ¯æ—¥åˆ°æ¯æ—¥çš„å‹ç¼©
- en: Of course â€œReplayingâ€ can be applied to the same timeframe but with a compression.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç„¶ï¼Œâ€œé‡æ”¾â€ä¹Ÿå¯ä»¥åº”ç”¨äºç›¸åŒçš„æ—¶é—´æ¡†æ¶ï¼Œä½†è¿›è¡Œå‹ç¼©ã€‚
- en: 'The console:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: æ§åˆ¶å°ï¼š
- en: '[PRE3]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This time we got half the bars as expected because of the factor 2 requested
    compression.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ¬¡æˆ‘ä»¬å¾—åˆ°äº†é¢„æœŸçš„ä¸€åŠKçº¿ï¼Œå› ä¸ºè¯·æ±‚çš„å‹ç¼©å› å­æ˜¯2ã€‚
- en: 'The chart:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: å›¾è¡¨ï¼š
- en: '![image](../Images/52c1bf0e292556480053142e8d4fca7d.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![å›¾ç‰‡](../Images/52c1bf0e292556480053142e8d4fca7d.png)'
- en: Conclusion
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: A reconstruction of the market development is possible. Usually a smaller timeframe
    set of data is available and can be used to discretely replay the timeframe which
    the system operates on.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: å¯ä»¥é‡å»ºå¸‚åœºå‘å±•çš„è¿‡ç¨‹ã€‚é€šå¸¸ä¼šæœ‰ä¸€ç»„è¾ƒå°æ—¶é—´æ¡†æ¶çš„æ•°æ®å¯ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥ç¦»æ•£åœ°é‡æ”¾ç³»ç»Ÿè¿è¡Œçš„æ—¶é—´æ¡†æ¶ã€‚
- en: The test script.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: æµ‹è¯•è„šæœ¬ã€‚
- en: '[PRE4]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
