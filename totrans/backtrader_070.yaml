- en: Extending Commissions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://www.backtrader.com/docu/extending-commissions/commission-schemes-extended/](https://www.backtrader.com/docu/extending-commissions/commission-schemes-extended/)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Commissions and asociated functionality were managed by a single class `CommissionInfo`
    which was mostly instantiated by calling `broker.setcommission`.
  prefs: []
  type: TYPE_NORMAL
- en: The concept was limited to futures with margin and a fixed commission per contract
    and stocks with a price/size percentage based commission. Not the most flexible
    of schemes even if it has served its purpose.
  prefs: []
  type: TYPE_NORMAL
- en: 'A request for enhancement on GitHub [#29](https://github.com/mementum/backtrader/issues/29)
    led to some rework in order to:'
  prefs: []
  type: TYPE_NORMAL
- en: Keep `CommissionInfo` and `broker.setcommission` compatible with the original
    behavior
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do some clean up of the code
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Make the Commission scheme flexible to support the enhancement request and further
    possibilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The actual work before getting to the sample
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'A base class for `CommissionInfo` has been introduced which add new parameters
    to the mix:'
  prefs: []
  type: TYPE_NORMAL
- en: '`commtype` (default: `None`)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'This is the key to compatibility. If the value is `None`, the behavior of the
    `CommissionInfo` object and `broker.setcommission` will work as before. Being
    that:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If `margin` is set then the commission scheme is for futures with a fixed commission
    per contract
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: If `margin` is not set, the commission scheme is for stocks with a percentage
    based approach
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: If the value is `COMM_PERC` or `COMM_FIXED` (or any other from derived classes)
    this obviously decides if the commission if fixed or percent based
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '`stocklike` (default: `False`)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: As explained above, the actual behavior in the old `CommissionInfo` object is
    determined by the parameter `margin`
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: As above if `commtype` is set to something else than `None`, then this value
    indicates whether the asset is a futures-like asset (margin will be used and bar
    based cash adjustment will be performed9 or else this a stocks-like asset
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '`percabs` (default: `False`)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If `False` then the percentage must be passed in relative terms (xx%)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If `True` the percentage has to be passed as an absolute value (0.xx)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '`CommissionInfo` is subclassed from `CommInfoBase` changing the default value
    of this parameter to `True` to keep the compatible behavior'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'All these parameters can also be used in `broker.setcommission` which now looks
    like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Notice the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '`percabs` is `True` to keep the behavior compatible with the old call as mentioned
    above for the `CommissionInfo` object'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The old sample to test `commissions-schemes` has been reworked to support command
    line arguments and the new behavior. The usage help:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Let’s do some runs to recreate the original behavior of the original commission
    schemes posts.
  prefs: []
  type: TYPE_NORMAL
- en: Commissions for futures (fixed and with margin)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The execution and chart:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![image](../Images/3b34821f141f4b6846b890b1429d0309.png)'
  prefs: []
  type: TYPE_IMG
- en: 'And the output showing a fixed commission of 2.0 monetary units (default stake
    is 1):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Commissions for stocks (perc and withoout margin)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The execution and chart:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '![image](../Images/f71981f061c32c988b10695da5e75c81.png)'
  prefs: []
  type: TYPE_IMG
- en: 'To improve readability a relative % value can be used:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Now `0.5` means directly `0.5%`
  prefs: []
  type: TYPE_NORMAL
- en: 'Being the output in both cases:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Commissions for futures (perc and with margin)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Using the new parameters, futures on a perc based scheme:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '![image](../Images/f71981f061c32c988b10695da5e75c81.png)'
  prefs: []
  type: TYPE_IMG
- en: It should come to no surprise that by changing the commission … the final result
    has changed
  prefs: []
  type: TYPE_NORMAL
- en: 'The output shows that the commission is variable now:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Being in the previous run set a 2.0 monetary units (for the default stake of
    1)
  prefs: []
  type: TYPE_NORMAL
- en: Another post will details the new classes and the implementation of a homme
    cooked commission scheme.
  prefs: []
  type: TYPE_NORMAL
- en: The code for the sample
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
